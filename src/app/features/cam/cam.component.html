<div class="page-container">
    <h1 class="page-title">Quản lý Cám</h1>

    <div class="content-card">
        <div class="card-toolbar">
            <div class="search-box">
                <div class="search-input-wrapper">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" placeholder="Tìm kiếm theo mã, tên, NSX..." class="search-input"
                        [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" />
                </div>
            </div>
            <button class="btn btn-primary" (click)="openModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14" />
                </svg>
                Thêm Cám Mới
            </button>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Mã Cám</th>
                        <th>Tên Cám</th>
                        <th>Nhà Sản Xuất</th>
                        <th>Hạn Sử Dụng</th>
                        <th>Ghi Chú</th>
                        <th>Hành Động</th>
                    </tr>
                </thead>
                <tbody>
                    @for (cam of paginatedCamsData; track cam.id; let i = $index) {
                    <tr>
                        <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                        <td>{{ cam.camCode }}</td>
                        <td>{{ cam.name }}</td>
                        <td>{{ cam.manufacturer }}</td>
                        <td>{{ cam.expiryDate }}</td>
                        <td class="note-cell" [title]="cam.note || ''">{{ cam.note }}</td>
                        <td class="actions">
                            <button class="action-btn edit" title="Sửa" (click)="openModal(cam)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
                                </svg>
                            </button>
                            <button class="action-btn delete" title="Xóa" (click)="deleteCam(cam.id)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="7" class="empty-message">Không có dữ liệu</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="card-footer" [class.has-pagination]="totalPages > 1">
            <div class="pagination" *ngIf="totalPages > 1">
                <button class="page-btn" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <div class="page-numbers">
                    <span>Trang {{ currentPage }} / {{ totalPages }}</span>
                </div>
                <button class="page-btn" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>

            <div class="total-summary">
                <span class="total-label">Tổng số: </span>
                <span class="total-value">{{ filteredCamsData.length }}</span>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="isModalOpen">
    <div class="modal-content">
        <div class="modal-header">
            <h2>{{ isEditing ? 'Cập Nhật Cám' : 'Thêm Cám Mới' }}</h2>
            <button class="close-btn" (click)="closeModal()">×</button>
        </div>
        <div class="modal-body">
            <form [formGroup]="camForm" (ngSubmit)="saveCam()">
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <label for="name">Tên Cám <span class="required">*</span></label>
                        <input type="text" id="name" formControlName="name" class="form-control"
                            [class.is-invalid]="camForm.get('name')?.invalid && camForm.get('name')?.touched"
                            placeholder="Nhập tên cám..." />
                        <div *ngIf="camForm.get('name')?.invalid && camForm.get('name')?.touched"
                            class="invalid-feedback">
                            Vui lòng nhập tên cám.
                        </div>
                    </div>

                    <div class="form-group" style="flex: 1;">
                        <label for="expiryDate">Hạn Sử Dụng</label>
                        <input type="date" id="expiryDate" formControlName="expiryDate" class="form-control" />
                    </div>
                </div>

                <div class="form-group">
                    <label for="manufacturer">Nhà Sản Xuất <span class="required">*</span></label>
                    <input type="text" id="manufacturer" formControlName="manufacturer" class="form-control"
                        [class.is-invalid]="camForm.get('manufacturer')?.invalid && camForm.get('manufacturer')?.touched"
                        placeholder="Nhập tên nhà sản xuất..." />
                    <div *ngIf="camForm.get('manufacturer')?.invalid && camForm.get('manufacturer')?.touched"
                        class="invalid-feedback">
                        Vui lòng nhập tên nhà sản xuất.
                    </div>
                </div>

                <div class="form-group">
                    <label for="note">Ghi Chú</label>
                    <textarea id="note" formControlName="note" class="form-control" rows="3"
                        placeholder="Nhập ghi chú..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeModal()">Hủy</button>
                    <button type="submit" class="btn btn-primary" [disabled]="camForm.invalid">
                        {{ isEditing ? 'Cập Nhật' : 'Lưu' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="isDeleteModalOpen">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2 class="text-danger">Xác nhận xóa</h2>
            <button class="close-btn" (click)="cancelDelete()">×</button>
        </div>
        <div class="modal-body">
            <p class="confirm-message">Bạn có chắc chắn muốn xóa cám này không? Hành động này không thể hoàn tác.
            </p>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="cancelDelete()">Hủy</button>
                <button type="button" class="btn btn-danger" (click)="confirmDelete()">Xóa</button>
            </div>
        </div>
    </div>
</div>