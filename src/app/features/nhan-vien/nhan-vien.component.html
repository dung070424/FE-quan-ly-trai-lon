<div class="page-container">
    <h1 class="page-title">Quản lý Nhân Viên</h1>

    <div class="content-card">
        <div class="card-toolbar">
            <div class="search-box">
                <div class="search-input-wrapper">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" placeholder="Tìm kiếm theo mã, tên, CCCD..." class="search-input"
                        [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" />
                </div>
            </div>
            <button class="btn btn-primary" (click)="openModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14" />
                </svg>
                Thêm Nhân Viên
            </button>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Mã NV</th>
                        <th>Tên Nhân Viên</th>
                        <th>Ngày Sinh</th>
                        <th>CCCD</th>
                        <th>Giới Tính</th>
                        <th>Địa Chỉ</th>
                        <th>Hành Động</th>
                    </tr>
                </thead>
                <tbody>
                    @for (employee of paginatedEmployeesData; track employee.id; let i = $index) {
                    <tr>
                        <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                        <td>{{ employee.employeeCode }}</td>
                        <td>{{ employee.name }}</td>
                        <td>{{ employee.dateOfBirth }}</td>
                        <td>{{ employee.identityCard }}</td>
                        <td>{{ employee.gender }}</td>
                        <td class="note-cell" [title]="employee.address || ''">{{ employee.address }}</td>
                        <td class="actions">
                            <button class="action-btn edit" title="Sửa" (click)="openModal(employee)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
                                </svg>
                            </button>
                            <button class="action-btn delete" title="Xóa" (click)="deleteEmployee(employee.id)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="8" class="empty-message">Không có dữ liệu</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="card-footer" [class.has-pagination]="totalPages > 1">
            <div class="pagination" *ngIf="totalPages > 1">
                <button class="page-btn" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <div class="page-numbers">
                    <span>Trang {{ currentPage }} / {{ totalPages }}</span>
                </div>
                <button class="page-btn" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>

            <div class="total-summary">
                <span class="total-label">Tổng số: </span>
                <span class="total-value">{{ filteredEmployeesData.length }}</span>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="isModalOpen">
    <div class="modal-content">
        <div class="modal-header">
            <h2>{{ isEditing ? 'Cập Nhật Nhân Viên' : 'Thêm Nhân Viên Mới' }}</h2>
            <button class="close-btn" (click)="closeModal()">×</button>
        </div>
        <div class="modal-body">
            <form [formGroup]="employeeForm" (ngSubmit)="saveEmployee()">
                <div class="form-group">
                    <label for="name">Tên Nhân Viên <span class="required">*</span></label>
                    <input type="text" id="name" formControlName="name" class="form-control"
                        placeholder="Nhập tên nhân viên" />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dateOfBirth">Ngày Sinh</label>
                        <input type="date" id="dateOfBirth" formControlName="dateOfBirth" class="form-control" />
                    </div>

                    <div class="form-group">
                        <label for="gender">Giới Tính</label>
                        <select id="gender" formControlName="gender" class="form-control">
                            <option value="Nam">Nam</option>
                            <option value="Nữ">Nữ</option>
                            <option value="Khác">Khác</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="identityCard">CCCD</label>
                    <input type="text" id="identityCard" formControlName="identityCard" class="form-control"
                        placeholder="Nhập số CCCD" />
                </div>

                <div class="form-group">
                    <label for="address">Địa Chỉ</label>
                    <textarea id="address" formControlName="address" class="form-control" rows="3"
                        placeholder="Nhập địa chỉ..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeModal()">Hủy</button>
                    <button type="submit" class="btn btn-primary" [disabled]="employeeForm.invalid">
                        {{ isEditing ? 'Cập Nhật' : 'Lưu' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="isDeleteModalOpen">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2 class="text-danger">Xác nhận xóa</h2>
            <button class="close-btn" (click)="cancelDelete()">×</button>
        </div>
        <div class="modal-body">
            <p class="confirm-message">Bạn có chắc chắn muốn xóa nhân viên này không? Hành động này không thể hoàn tác.
            </p>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="cancelDelete()">Hủy</button>
                <button type="button" class="btn btn-danger" (click)="confirmDelete()">Xóa</button>
            </div>
        </div>
    </div>
</div>