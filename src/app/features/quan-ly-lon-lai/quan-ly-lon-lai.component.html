<div class="page-container">
    <h1 class="page-title">Quản lý Lợn Nái</h1>

    <div class="content-card">
        <div class="card-toolbar">
            <div class="search-box">
                <div class="search-input-wrapper">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" placeholder="Tìm kiếm theo mã lợn nái..." class="search-input"
                        [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" />
                </div>
            </div>
            <button class="btn btn-primary" (click)="openModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14" />
                </svg>
                Thêm Lợn Nái Mới
            </button>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Mã Lợn Nái</th>
                        <th>Giống</th>
                        <th>Ngày Sinh</th>
                        <th>Nguồn Gốc</th>
                        <th>Trạng Thái</th>
                        <th>Ghi Chú</th>
                        <th>Hành Động</th>
                    </tr>
                </thead>
                <tbody>
                    @for (sow of paginatedSowsData; track sow.id; let i = $index) {
                    <tr>
                        <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                        <td><span style="font-weight: 600;">{{ sow.tagNumber }}</span></td>
                        <td>{{ sow.breed }}</td>
                        <td>{{ sow.birthDate }}</td>
                        <td>{{ sow.origin }}</td>
                        <td>
                            <span class="status-badge" [ngClass]="sow.status === 'Đang chửa' ? 'status-pregnant' : 
                                            (sow.status === 'Đang nuôi con' ? 'status-nursing' : 
                                            (sow.status === 'Trống' ? 'status-empty' : 'status-other'))">
                                {{ sow.status }}
                            </span>
                        </td>
                        <td class="note-cell" [title]="sow.notes || ''">{{ sow.notes }}</td>
                        <td class="actions">
                            <button class="action-btn edit" title="Sửa" (click)="openModal(sow)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
                                </svg>
                            </button>
                            <button class="action-btn delete" title="Xóa" (click)="deleteSow(sow.id)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="8" class="empty-message">Không có dữ liệu</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="card-footer" [class.has-pagination]="totalPages > 1">
            <div class="pagination" *ngIf="totalPages > 1">
                <button class="page-btn" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <div class="page-numbers">
                    <span>Trang {{ currentPage }} / {{ totalPages }}</span>
                </div>
                <button class="page-btn" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="isModalOpen">
    <div class="modal-content">
        <div class="modal-header">
            <h2>{{ isEditing ? 'Cập Nhật Lợn Nái' : 'Thêm Lợn Nái Mới' }}</h2>
            <button class="close-btn" (click)="closeModal()">×</button>
        </div>
        <div class="modal-body">
            <form [formGroup]="sowForm" (ngSubmit)="saveSow()">

                <div class="form-row">
                    <div class="form-group">
                        <label for="tagNumber">Mã Lợn Nái <span class="required">*</span></label>
                        <input type="text" id="tagNumber" formControlName="tagNumber" class="form-control"
                            placeholder="Ví dụ: NAI-001" />
                    </div>
                    <div class="form-group">
                        <label for="breed">Giống <span class="required">*</span></label>
                        <input type="text" id="breed" formControlName="breed" class="form-control"
                            placeholder="Landrace, Yorkshire..." />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="birthDate">Ngày Sinh <span class="required">*</span></label>
                        <input type="date" id="birthDate" formControlName="birthDate" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="origin">Nguồn Gốc <span class="required">*</span></label>
                        <input type="text" id="origin" formControlName="origin" class="form-control"
                            placeholder="Trại ABC" />
                    </div>
                </div>

                <div class="form-group">
                    <label for="status">Trạng Thái <span class="required">*</span></label>
                    <select id="status" formControlName="status" class="form-control">
                        <option value="" disabled>Chọn trạng thái</option>
                        <option value="Đang chửa">Đang chửa</option>
                        <option value="Đang nuôi con">Đang nuôi con</option>
                        <option value="Trống">Trống</option>
                        <option value="Đã thải loại">Đã thải loại</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="notes">Ghi Chú</label>
                    <textarea id="notes" formControlName="notes" class="form-control" rows="2"
                        placeholder="Nhập ghi chú (không bắt buộc)..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeModal()">Hủy</button>
                    <button type="submit" class="btn btn-primary" [disabled]="sowForm.invalid">
                        {{ isEditing ? 'Cập Nhật' : 'Lưu' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="isDeleteModalOpen">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2 class="text-danger">Xác nhận xóa</h2>
            <button class="close-btn" (click)="cancelDelete()">×</button>
        </div>
        <div class="modal-body">
            <p class="confirm-message">Bạn có chắc chắn muốn xóa con lợn nái này không? Hành động này không thể hoàn
                tác.</p>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="cancelDelete()">Hủy</button>
                <button type="button" class="btn btn-danger" (click)="confirmDelete()">Xóa</button>
            </div>
        </div>
    </div>
</div>